{% extends 'base.html' %}
{% load static %}
{% block content %}
    <main class="lyear-layout-content">

        <div class="container-fluid">
            <div class="row">

                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header"><h4>查询图谱---<a href="http://localhost:7474/browser/" target="_blank">查看图谱数据库</a></h4></div>
                        <div class="card-body">

                            <form action="/" method="get">
                                {% csrf_token %}
                                <div class="form-group">
                                    <label for="example-nf-email">开始节点</label>
                                    <input class="form-control" type="text" name="start" placeholder="请输入节点..">
                                </div>
                                <div class="form-group">
                                    <label for="example-nf-email">关系</label>
                                    <input class="form-control" type="text" name="relation" placeholder="请输入关系..">
                                </div>
                                <div class="form-group">
                                    <label for="example-nf-email">结束节点</label>
                                    <input class="form-control" type="text" name="end" placeholder="请输入节点..">
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary" type="submit">查询节点</button>
                                </div>
                            </form>

                        </div>
                    </div>


                </div>

                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header"><h4>图谱展示</h4></div>
                        <div class="card-body">

                            <div id="main" style="width: 100%;height: 600px"></div>

                        </div>
                    </div>


                </div>
            </div>


        </div>

    </main>
    <script src="/static/jquery-1.10.2.min.js"></script>
    <script src="/static/echarts.min.js"></script>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        option1 = {
            // backgroundColor: "white",
            title: {
                text: '关系图谱',
                textStyle: {
                    // color: "white",
                    fontWeight: "lighter",
                }
            },
            animationDurationUpdate: 1500,
            animationEasingUpdate: 'quinticInOut',
            legend: {
                x: "center",
                show: true,
                data: {{ legend_data | safe }}
            },
            series: [
                {
                    type: 'graph',
                    layout: 'force',
                    symbolSize: 50,
                    edgeSymbol: ['circle', 'arrow'],
                    edgeSymbolSize: [4, 10],
                    edgeLabel: {
                        normal: {
                            show: true,
                            formatter: function (x) {
                                return x.data.name;
                            },
                            textStyle: {
                                fontSize: 10
                            },
                        }
                    },
                    force: {
                        repulsion: 2500,
                        edgeLength: [10, 100]
                    },
                    focusNodeAdjacency: true,
                    draggable: true,
                    roam: true,
                    categories: {{ categories | safe }},
                    label: {
                        normal: {
                            show: true,
                            textStyle: {
                                fontSize: 10
                            },
                        }
                    },
                    force: {
                        repulsion: 1000
                    },
                    tooltip: {
                        formatter: function (node) { // 区分连线和节点，节点上额外显示其他数字
                            if (!node.value) {
                                return node.data.name;
                            } else {
                                return node.data.name + ":" + node.data.showNum;
                            }
                        },
                    },
                    lineStyle: {
                        normal: {
                            opacity: 1.0,
                            width: 2,
                            curveness: 0.3
                        }
                    },
                    // progressiveThreshold: 700,
                    nodes: {{ datas | safe }},
                    links: {{ links | safe }},

                }
            ]
        };
        myChart.setOption(option1);
    </script>
{% endblock %}
