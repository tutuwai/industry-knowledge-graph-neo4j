{% extends 'base.html' %}
{% load static %}
{% block content %}
    <main class="lyear-layout-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <div id="container" style="height: 780px"></div>
                            <div>
                                <button id="addNodeBtn" class="btn btn-primary">添加节点</button>
                                <button id="deleteNodeBtn" class="btn btn-danger">删除节点</button>
                            </div>
                            <div id="nodeInfo"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://registry.npmmirror.com/echarts/5.5.0/files/dist/echarts.min.js"></script>
    <script type="text/javascript">
        var dom = document.getElementById('container');
        var myChart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        var option;

        myChart.showLoading();
        $.get('/static/data/fengji-tree.json', function (data) {
            myChart.hideLoading();
            data.children.forEach(function (datum, index) {
                index % 2 === 0 && (datum.collapsed = true);
            });
            myChart.setOption(
                (option = {
                    tooltip: {
                        trigger: 'item',
                        triggerOn: 'mousemove'
                    },
                    series: [
                        {
                            type: 'tree',
                            data: [data],
                            top: '1%',
                            left: '7%',
                            bottom: '1%',
                            right: '20%',
                            symbolSize: 7,
                            label: {
                                position: 'left',
                                verticalAlign: 'middle',
                                align: 'right',
                                fontSize: 9
                            },
                            leaves: {
                                label: {
                                    position: 'right',
                                    verticalAlign: 'middle',
                                    align: 'left'
                                }
                            },
                            emphasis: {
                                focus: 'descendant'
                            },
                            expandAndCollapse: true,
                            animationDuration: 550,
                            animationDurationUpdate: 750
                        }
                    ]
                })
            );
        });

        // 添加节点按钮点击事件
        $('#addNodeBtn').on('click', function () {
            // 你可以在这里添加代码来实现添加节点的逻辑
            // 例如，弹出一个模态框来输入新节点的信息，然后根据输入的信息添加节点
            // 添加节点后，更新图表数据并重新渲染图表
            // 这里只是示例，具体实现取决于你的需求
            alert('添加节点功能待实现');
        });

        // 删除节点按钮点击事件
        $('#deleteNodeBtn').on('click', function () {
            // 你可以在这里添加代码来实现删除节点的逻辑
            // 例如，选中某个节点，然后删除该节点及其相关的连接
            // 删除节点后，更新图表数据并重新渲染图表
            // 这里只是示例，具体实现取决于你的需求
            alert('删除节点功能待实现');
        });

        // 监听图表点击事件，显示点击节点的信息
        myChart.on('click', function (params) {
            if (params.componentType === 'series') {
                var nodeInfo = params.data;
                $('#nodeInfo').html('<p>节点信息：</p><pre>' + JSON.stringify(nodeInfo, null, 2) + '</pre>');
            }
        });

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }

        window.addEventListener('resize', myChart.resize);
    </script>
{% endblock %}