<template>
  <!--复选框-->
  <div class="selections">
    <el-checkbox v-model="sector" label="环节" size="large"/>
    <el-checkbox v-model="product" label="代理机构" size="large"/>
    <el-checkbox v-model="company" label="专利" size="large"/>
    <el-checkbox v-model="up" label="IPC" size="large"/>
    <el-checkbox v-model="mid" label="发明人" size="large"/>
    <el-checkbox v-model="down" label="申请人" size="large"/>
  </div>
  <!--结点颜色含义放置框：框内为各类结点对应颜色-->
  <div class="indicator">
    <div class="list_color" v-for="(name, index) in names" :key="index">
      <span :style="{ backgroundColor: colors[index] }">{{ name }}</span>
    </div>
  </div>
  <!--图谱可视化区域-->
  <svg>
    <force-graph v-if="displayMode === 'normal'" :url="api1" v-on:clickNode="showNodeInfo" :Down="down" :Mid="mid"
                 :Up="up"
                 @update-statistics="handleStatisticsUpdate"/>
    <ForceGraph_pagerank v-if="displayMode === 'importance'" :url="api1" v-on:clickNode="showNodeInfo"
                         @update-statistics="handleStatisticsUpdate"/>
  </svg>
  <!--  统计结点和关系信息-->
  <table class="info">
    <thead>
    <tr>
      <th>分类</th>
      <th>数量</th>
    </tr>
    </thead>
    <tbody>
    <tr v-for="(value, key) in nodeStatistics" :key="key">
      <td>{{ key }}</td>
      <td>{{ value }}</td>
    </tr>
    </tbody>
  </table>
  <!--每个结点的信息-->
  <div class="node_info" v-html="selectedNode ? selectedNodeInfo : ''"></div>
  <!--时间范围输入查询-->
  <div class="in_date">
    <date-picker v-model="dateRange" @update:value="handleDatepickerChange"/>
  </div>
  <!--新增：下拉框选择展示类型-->
  <div class="display_type">
    <el-select v-model="displayMode" placeholder="请选择">
      <el-option label="普通模式" value="normal"></el-option>
      <el-option label="重要度模式" value="importance"></el-option>
    </el-select>
  </div>
  <!--新增：生成图标按钮-->
  <div class="generate_button">
    <el-button type="primary" @click="updateGraph">更新图谱</el-button>
  </div>
</template>
<script>
import DatePicker from "../components/DatePicker.vue";
import ForceGraph_pagerank from "../components/ForceGraph_pagerank.vue";
import ForceGraph from "../components/ForceGraph_Graph.vue";
import moment from "moment";

let bool_input = false;
export default {
  name: "HomePage",
  components: {ForceGraph, DatePicker, ForceGraph_pagerank},
  data() {
    return {
      //http://192.168.124.5:5000
      //http://127.0.3.1:5050/
      api1: "http://127.0.3.1:5050/datas?link=true&product=false&company=true&start_time=1990-10-10&end_time=2020-10-10",
      names: ["IPC",'发明人','申请人', "专利", "代理机构"],
      colors: ["rgb(163,133,166)", "#2aad5c", "#ffec4b",
        '#f1662b', '#FFC0CB'],
      sector: true,
      company: true,
      product: false,
      search_input: "",
      dateRange: [],
      start_time: "1900-10-10",
      end_time: "2023-4-10",
      selectedNode: null,
      tips_info: null,
      displayMode: "normal",
      nodeStatistics: [],
      up: false,
      down: false,
      mid: false,
    };
  },
  methods: {
    //更新结点状态信息
    handleStatisticsUpdate(statistics) {
      this.nodeStatistics = statistics;
      //console.log("ABCDE:", this.nodeStatistics);
    },
    handleInputSubmit(inputString) {
      if (inputString != "") bool_input = true;
      else bool_input = false;
      this.search_input = inputString;
      if (bool_input == true) {
        const params = {
          search_input: this.search_input,
        };
        const queryString = Object.keys(params)
            .map((key) => params[key])
            .join("&");
        this.api1 = "http://127.0.3.1:5050/datas/community?name=" + queryString;
        console.log("new_api1=", this.api1);
      }
    },
    handleDatepickerChange(value) {
      //this.start_time = moment(value[0]).format("YYYY-MM-DD");
      this.end_time = moment(value).format("YYYY-MM-DD");
    },
    // 新增：更新图表方法
    updateGraph() {
      if (bool_input == false) {
        const params = {
          link: this.sector,
          product: this.product,
          company: this.company,
          start_time: this.start_time,
          end_time: this.end_time,
        };
        const queryString = Object.keys(params)
            .map((key) => key + "=" + params[key])
            .join("&");
        this.api1 = "http://127.0.3.1:5050/datas?" + queryString;
        console.log("new_api1=", this.api1);
      }
    },
    //展示结点信息
    showNodeInfo(node) {
      if (!node) {
        return;
      }
      this.selectedNode = node;
      //console.log('clicked node:', node);
    },
  },
  computed: {
    selectedNodeInfo() {
      const node = this.selectedNode;
      //console.log('结点信息:', node);
      if (node) {
        if (node.group == 1) {
          return `
          <div>结点id: ${node.id}</div>
          <div>结点名称: ${node.name}</div>
          <div>专利代码: ${node.code}</div>
          <div>专利全称: ${node.fullname}</div>
          <div>所在城市: ${node.city}</div>
          <div>专利所在地: ${node.where}</div>
          <div>专利网址: ${node.web}</div>
          <div>成立日期: ${moment(node.date).format("YYYY-MM-DD")}</div>
          <div>首发上市日: ${moment(node.date1).format("YYYY-MM-DD")}</div> `;
        } else {
          return `
          <div>结点id: ${node.id}</div>
          <div>结点名称: ${node.name}</div>`;
        }
      }
      return '';
    },
  },
};
</script>


async loadData() {
      try {
        this.clearData();
        const response = await axios.get(this.url);
        const companies = response.data.results.公司;
        const products = response.data.results.产品;
        const sectors = response.data.results.环节;
        const ss = response.data.results.环节与环节;
        const sc = response.data.results.环节与公司;
        const sp = response.data.results.环节与产品;
        const cc = response.data.results.公司与供应商;
        const cp = response.data.results.公司与产品;
        const pp = response.data.results.产品与产品;

        // 更新统计信息
        this.statistics.环节 = sectors.length;
        this.statistics.公司 = companies.length;
        this.statistics.产品 = products.length;
        this.statistics.环节与环节 = ss.length;
        this.statistics.环节与公司 = sc.length;
        this.statistics.环节与产品 = sp.length;
        this.statistics.公司与公司 = cc.length;
        this.statistics.公司与产品 = cp.length;
        this.statistics.产品与产品 = pp.length;
        console.log(this.statistics);
        // 向父组件发送统计信息
        this.$emit('update-statistics', this.statistics);
        // console.log(companies);
        for (const item of products) {
          if (item.name === undefined || item.id === undefined) {
            //console.error('Undefined product:', item);
          } else {
            this.nodes.push({
              name: item.name,
              id: item.id,
              up: item.up,
              mid: item.mid,
              down: item.down,
              group: 2 //结点颜色代号
            })
            //console.log(item.name);
          }
        }
        for (const item of companies) {
          const dateString = item.成立日期 + "/" + item.首发上市日;
          const parts = dateString.split("/");
          const dateObj = new Date(parts[0], parts[1] - 1, parts[2]);//月份需要减1，因为JS中的月份从0开始计数
          const dateObj1 = new Date(parts[3], parts[4] - 1, parts[5]);
          if (item.name === undefined || item.id === undefined) {
            //console.error('Undefined company:', item);
          } else {
            this.nodes.push({
              name: item.name,
              id: item.id,
              group: 1, //结点颜色代号
              city: item.city,
              fullname: item.fullname,
              code: item.code,
              where: item.所属地区,
              web: item.公司网址,
              date: dateObj,
              date1: dateObj1,
              up: item.up,
              mid: item.mid,
              down: item.down,
            })
          }
        }
        for (const item of sectors) {
          if (item.name === undefined || item.id === undefined) {
            //console.error('Undefined link:', item);
          } else {
            this.nodes.push({
              name: item.name,
              id: item.id,
              up: item.up,
              mid: item.mid,
              down: item.down,
              group: 0 //结点颜色代号

            })
          }
        }

        for (const item of ss) {
          if (item.id_from === undefined || item.id_to === undefined) {
            //console.error('Undefined ss:', item);
          } else {
            this.links.push({
              source: item.id_from,
              target: item.id_to,
              type: item.rel,
              group: 0
            })
          }
        }
        for (const item of sc) {
          if (item.id_from === undefined || item.id_to === undefined) {
            //console.error('Undefined ss:', item);
          } else {
            this.links.push({
              source: item.id_from,
              target: item.id_to,
              type: item.rel,
              group: 1
            })
          }
        }
        for (const item of sp) {
          if (item.id_from === undefined || item.id_to === undefined) {
            //console.error('Undefined ss:', item);
          } else {
            this.links.push({
              source: item.id_from,
              target: item.id_to,
              type: item.rel,
              group: 2
            })
          }
        }
        for (const item of cc) {
          if (item.id_from === undefined || item.id_to === undefined) {
            //console.error('Undefined ss:', item);
          } else {
            this.links.push({
              source: item.id_from,
              target: item.id_to,
              type: item.rel,
              group: 3
            })
          }
        }
        for (const item of cp) {
          if (item.id_from === undefined || item.id_to === undefined) {
            //console.error('Undefined ss:', item);
          } else {
            this.links.push({
              source: item.id_from,
              target: item.id_to,
              type: item.rel,
              group: 4
            })
          }
        }
        for (const item of pp) {
          if (item.id_from === undefined || item.id_to === undefined) {
            //console.error('Undefined ss:', item);
          } else {
            this.links.push({
              source: item.id_from,
              target: item.id_to,
              type: item.rel,
              group: 5
            })
          }
        }
        console.log('links:', this.links);
        console.log('nodes:', this.nodes);
        this.drawGraph();
      } catch (error) {
        //console.error(error)
      }
    },
我现在想以这个项目为蓝本去更改他的设置，来显示我的知识图谱，
首先api1得换成：
api1: "http://127.0.3.1:5001/datas?score_patent=7&score_agent=10&score_inventor=3&score_ipc=40&score_applicant=10",
请求到的数据格式如下：
{
  "status": "success",
  "message": "数据查询成功",
  "results": {
    "专利": [ {
                "id": 30,
                "pageRankScore": 11.563378369519324,
                "type": "专利",
                "公开号": "CN105934322A",
                "公开日": "2016.09.07",
                "名称": "通过连续填料浆料挤出的聚合物组合物",
                "摘要": "本发明提供用于生产聚合物组合物的创造性方法，所述方法包括将填料并入聚合物材料中，其中在填料并入期间的所述聚合物材料处于至少部分熔融态并且其中所述填料以浆料形式被并入。",
                "文献类型": "发明",
                "申请号": "CN201480070466.7",
                "申请日": "2014.12.17"
            }],
    "IPC": [{
                "id": 5776,
                "pageRankScore": 93.37297563224972,
                "type": "IPC",
                "名称": "E21F17/18"
            }],
    "发明人": [{
                "id": 11236,
                "pageRankScore": 26.830267249806365,
                "type": "发明人",
                "名称": "何川"
            }],
    "申请人": [{
                "id": 31716,
                "pageRankScore": 33.3635236584548,
                "type": "申请人",
                "名称": "西南交通大学",
                "邮编": "610031.0"
            }],
    "代理机构": [{
                "id": 9809,
                "pageRankScore": 24.001806252940053,
                "type": "代理机构",
                "名称": "济南圣达知识产权代理有限公司"
            }],
    "专利与专利": [{
                "from": "CN206103150U",
                "from_type": "专利",
                "id_from": 1333,
                "id_to": 1354,
                "rel": "CITES_BY",
                "to": "CN106075773A",
                "to_type": "专利"
            }],
    "专利与IPC": [{
                "from": "CN117266872A",
                "from_type": "专利",
                "id_from": 5544,
                "id_to": 5776,
                "rel": "BELONGS_TO",
                "to": "E21F17/18",
                "to_type": "IPC"
            }],
    "专利与发明人": [ {
                "from": "CN206021335U",
                "from_type": "专利",
                "id_from": 1188,
                "id_to": 12214,
                "rel": "INVENTED_BY",
                "to": "张伟",
                "to_type": "发明人"
            }],
    "专利与代理机构": [ {
                "from": "CN108037770A",
                "from_type": "专利",
                "id_from": 1839,
                "id_to": 9809,
                "rel": "REPRESENTED_BY",
                "to": "济南圣达知识产权代理有限公司",
                "to_type": "代理机构"
            }],
  }
}